<!--订单详情模态框-->
<div class="ui long coupled modal shoppingCartDetailShow">
    <i class="close icon"></i>
    <div class="content">
        <div class="description">
            <h3 class="ui horizontal header divider">
                <i class="shop icon"></i>
                你的订单
            </h3>
            <!--<form class="ui form">-->
                <table class="ui table">
                    <thead>
                    <tr>
                        <th class="three wide">商品类型</th>
                        <th class="three wide">图片</th>
                        <th class="three wide">商品名</th>
                        <th class="two wide">购买数</th>
                        <th class="two wide">价格</th>
                        <th class="three">删除</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{each user.shoppingCart}}
                    <tr data-id="{{$value._id}}">
                        <td>{{$value.type}}</td>
                        <td><a href="/Goods/{{$value._id}}"><img style="width: 60px;height: 60px" src="{{$value.headSrc}}"></a></td>
                        <td class="global_text_danger">{{$value.name}}</td>
                        <td class="ui input" style="padding-top: 25px"><input min="0" max="{{$value.resNum}}" type="number" name="buyNum" value="{{$value.buyNum}}"></td>
                        <td class="global_text_success">{{$value.price}}</td>
                        <td><button class="ui red button deleteShoppingCartBtn">删除</button></td>
                    </tr>
                    {{/each}}
                    </tbody>
                </table>
            <!--</form>-->
        </div>
    </div>
    <div class="actions">
        <div class="ui orange button buyShoppingCartShow">
            购买全部
            <i class="right payment icon"></i>
        </div>
    </div>
</div>

<!--删除确认控制-->
<div class="ui basic coupled second modal buyShoppingCartModal">
    <div class="header">
        <h1>购买确认</h1>
    </div>
    <div class="content">
        <div class="image" style="float: left">
            <i class="payment green icon"></i>
        </div>
        {{if user.secPassword == ""}}
        <div class="description">
            <p>确认购买该商品吗？</p>
            <p class="global_text_warning"><i class="warning red sign icon"></i>警告:您尚未设置二级密码,为保证用户安全请尽快<a href="/personalInfo" style="color: orangered">前往设置</a></p>
        </div>
        {{else}}
        {{/if}}
    </div>
    <div class="actions">
        <div class="two fluid ui inverted buttons">
            <div class="ui red basic cancel inverted button returnCartBtn">
                <i class="remove icon"></i>
                容我三思
            </div>
            <a class="ui green ok basic inverted button confirmBuy">
                <i class="checkmark icon"></i>
                确认购买
            </a>
        </div>
    </div>
</div>

<script src="/tools/jquery-2.0.3.min.js"></script>
<script src="/tools/semanticUI/semantic.min.js"></script>

<script>
    //控制购买数量
    $(document).on('keyup',"input[name='buyNum']",function(){
        if($(this).val() > parseInt($(this).attr("max"))){
            $(this).val($(this).attr("max"));
        }
    });

    $('.coupled.modal').modal({allowMultiple: false});
    $('.second.modal').modal('attach events', '.buyShoppingCartShow');
    $(".shoppingCartDetailShow").modal('attach events','.returnCartBtn');

    $(".shoppingCartDetailShow").on("click",".deleteShoppingCartBtn",function(){
        var loc = $(this);

        console.log($(this).parent().parent().attr("data-id"));
        $.ajax({
            url: "/ShoppingCart/delete",
            type: "delete",
            data: {
                id: $(this).parent().parent().attr("data-id")
            },
            success: function(){
                alert("删除成功")
                loc.parent().parent().remove();
            },error: function(){
                alert("删除失败!!")
            }
        });
    });


</script>
