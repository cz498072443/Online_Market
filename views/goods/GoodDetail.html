{{include './../headers'}}

{{include './../nav'}}

<div class="pusher">
    <div class="full height">
        <div class="header segment">
            <div class="ui three column horizontally padded grid head_info">
                <div class="equal height row">
                    <div class="red column">
                        <h3>Hello {{user.username}}!</h3>
                    </div>
                    <div class="blue column">
                        <p>当前账户余额: <span class="global_text_danger">{{user.wallet || 0}}</span> 元</p>
                    </div>
                    <div class="green column">
                        <p>这是一个长行，旁边有很多文本内容。</p>
                        <p>可能会占用很多段落。</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui grid main container buyControl" style="padding: 0">
            <div class="ui right very close rail">
                <div class="ui segment">
                    右侧轨道
                </div>
            </div>
            <h3 class="ui horizontal header divider"><i class="tag icon"></i></h3>
            <div class="doubling two column row relaxed">
                <div class="column">
                    <div class="ui card" style="width: 80%;margin: 0px auto">
                        <div class="image">
                            <a class="ui corner red label"><i class="heart icon"></i></a>
                            <img src="{{goodDetail.headSrc}}">
                        </div>
                        <div class="extra">
                            <div class="ui star rating" data-rating="3"></div>
                            <!--<div data-rating="3" class="ui star rating"><i class="icon active"></i><i class="icon active"></i><i class="icon active"></i><i class="icon"></i></div>-->
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="content" style="margin-top: 30px">
                        <h1 class="header">{{goodDetail.name}}</h1>
                    </div>
                    <div class="meta">
                        <p style="">{{goodDetail.type}}</p>
                    </div>
                    <div class="description" style="padding-left:10px;height:50px;line-height:50px;margin-top: 20px;background-color:#F1F1F1;width: 70%;">
                        <div class="ui two column centered grid">
                            <div class="column"><h3>价格:</h3></div>
                            <div class="column"><h1 class="ui red header">{{goodDetail.price}}元</h1></div>
                        </div>
                    </div>
                    <div class="ui form" style="margin-top: 20px">
                        <!--<div class="three fields">-->
                            <div class="inline field">
                                <label>购买数量:</label>
                                <input type="number" name="buyNum" min="1" value="1" max="{{goodDetail.resNum}}"> <label style="color:orange"> 剩余存货: {{goodDetail.resNum}}</label>
                            </div>
                        <!--</div>-->
                    </div>
                    <h3 class="ui horizontal header divider"><i class="chevron circle down icon"></i></h3>
                    <div class="ui large button orange">加入购物车</div><br><br>
                    <div class="ui large button red buyNow">立即购买</div>
                </div>
            </div>
        </div>
        <div class="ui centered grid main container goodContent">
            <div class="fifteen wide column row">
                <h3 class="ui horizontal header divider"><i class="chevron circle down icon"></i>商品介绍</h3>
            </div>
            <div class="fifteen wide column">
                {{#goodDetail.content}}
            </div>

        </div>
    </div>
</div>

<!--删除确认控制-->
<div class="ui basic demo modal check_modal">
    <div class="header">
        <h1>购买确认</h1>
    </div>
    <div class="content">
        <div class="image" style="float: left">
            <i class="payment green icon"></i>
        </div>
        {{if user.secPassword == ""}}
        <div class="description">
            <p>确认购买该商品吗？</p>
            <p class="global_text_warning"><i class="warning red sign icon"></i>警告:您尚未设置二级密码,为保证用户安全请尽快<a href="/personalInfo" style="color: orangered">前往设置</a></p>
        </div>
        {{else}}
        {{/if}}
    </div>
    <div class="actions">
        <div class="two fluid ui inverted buttons">
            <div class="ui red basic cancel inverted button">
                <i class="remove icon"></i>
                容我三思
            </div>
            <a class="ui green ok basic inverted button confirmBuy">
                <i class="checkmark icon"></i>
                确认购买
            </a>
        </div>
    </div>
</div>

<script src="/tools/template-native.js"></script>
<script type="text/javascript">

    $(document).ready(function(){
        var loadConfig = (function(){
            $('.ui.rating').rating();

            $('.demo.modal').modal();

            $('.basic.demo.modal').modal('attach events', '.buyNow');

            //控制购买数量
            $("input[name='buyNum']").keyup(function(){
                if($(this).val() > {{goodDetail.resNum}}){
                    $("input[name='buyNum']").val("{{goodDetail.resNum}}")
                }
            });

            //购买按钮
            $(document).on('click','.buttons .confirmBuy',function(){
                $.ajax({
                    url:"/Goods",
                    type:"POST",
                    data:{
                        goodId: "{{goodDetail.id}}",
                        buyNum: $("input[name='buyNum']").val()
                    },
                    success:function(){
                        window.location.href="/Goods/paySecceed/{{goodDetail.id}}";
                    },
                    error: function (){
                        alert("购买失败");
                    }
                });
            })
        })();

    })

</script>
